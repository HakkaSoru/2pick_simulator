<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2Pick Simulator</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f3f4f6;
            color: #1f2937;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 960px;
            gap: 2rem;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            padding: 2rem;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1,
        h2,
        h3 {
            color: #111827;
            text-align: center;
        }

        #status-message {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #4b5563;
        }

        #class-selection,
        #pick-phase {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .class-buttons,
        .card-choices-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1.5rem;
            width: 100%;
        }

        .class-select-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
            width: 45%;
        }

        .class-select-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .card-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 45%;
            padding: 1rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
        }

        .card-group:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .card-pair {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .card-name {
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.5;
            text-align: center;
        }

        .card-pair p {
            margin: 0.25rem 0;
            font-size: 0.875rem;
        }

        .button {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s;
            margin-top: 1rem;
        }

        .button:hover {
            background-color: #2563eb;
        }

        #reroll-button {
            background-color: #ef4444;
        }

        #reroll-button:hover {
            background-color: #dc2626;
        }

        .deck-list-container {
            width: 100%;
            max-width: 400px;
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .deck-list {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .deck-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.95rem;
        }

        .deck-list li:last-child {
            border-bottom: none;
        }

        #log {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
        }

        #log p {
            margin: 0.5rem 0;
            border-bottom: 1px dashed #9ca3af;
            padding-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        #log p:last-child {
            border-bottom: none;
        }

        .completed-message {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #10b981;
            margin-top: 2rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="main-content">
            <h1>2Pick シミュレーター</h1>
            <div id="status-message"></div>

            <div id="class-selection">
                <h2>クラス選択</h2>
                <div class="class-buttons" id="class-buttons"></div>
            </div>

            <div id="pick-phase" style="display: none;">
                <h2>ピック段階 <span id="pick-count"></span></h2>
                <p>デッキ枚数：<span id="deck-card-count">0</span>枚</p>
                <div class="card-choices-container" id="card-choices-container"></div>
                <button id="reroll-button" class="button">再抽選 (残り <span id="reroll-count"></span>回)</button>
            </div>

            <div class="deck-list-container">
                <h3>デッキリスト</h3>
                <canvas id="mana-curve-chart" width="350" height="150"></canvas>
                <ul id="current-deck" class="deck-list"></ul>
            </div>

            <div id="qrcode-container" style="text-align: center; margin-top: 2rem;">
                <button id="generate-qr-button" class="button">QRコード生成</button>
                <div id="qrcode-display" style="margin-top: 1rem; display: none;"></div>
            </div>

            <div id="log">
                <h3>ログ</h3>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        window.onload = function () {
            const neutralCards = [
                { id: "10301310", name: "至高の凌駕", cost: 4, rarity: "ブロンズ", group: "new-n" },
                { id: "10301110", name: "干絶の使徒", cost: 4, rarity: "ブロンズ", group: "new-n" },
                { id: "10302110", name: "嘆きに立ちし者", cost: 2, rarity: "シルバー", group: "new-n" },
                { id: "10304120", name: "干絶の顕現ギルネリーゼ", cost: 3, rarity: "レジェンド", group: "new-n" },
                { id: "10303110", name: "勇気に満ちし者", cost: 3, rarity: "ゴールド", group: "new-n" },
                { id: "10303210", name: "試練の石板", cost: 3, rarity: "ゴールド", group: "new-n" },
                { id: "10304110", name: "絶大の顕現マゼルベイン", cost: 4, rarity: "レジェンド", group: "new-n" },

                { id: "10001210", name: "探偵のルーペ", cost: 3, rarity: "ブロンズ", group: "normal-n" },
                { id: "10001110", name: "不屈のファイター", cost: 2, rarity: "ブロンズ", group: "normal-n" },
                { id: "10001120", name: "ベルエンジェルリア", cost: 2, rarity: "ブロンズ", group: "normal-n" },
                { id: "10001130", name: "激震のゴリアテ", cost: 4, rarity: "ブロンズ", group: "normal-n" },
                { id: "10101110", name: "グリードケルブルビィ", cost: 2, rarity: "ブロンズ", group: "normal-n" },
                { id: "10101120", name: "観察の探偵", cost: 3, rarity: "ブロンズ", group: "normal-n" },
                { id: "10101310", name: "ゴブリンの襲撃", cost: 5, rarity: "ブロンズ", group: "normal-n" },
                { id: "10201310", name: "リバースチェンジ", cost: 2, rarity: "ブロンズ", group: "normal-n" },
                { id: "10201110", name: "二刀のゴブリン", cost: 1, rarity: "ブロンズ", group: "normal-n" },
                { id: "10002110", name: "煌響の使者アンリエット", cost: 3, rarity: "シルバー", group: "normal-n" },
                { id: "10002210", name: "冒険者のギルド", cost: 3, rarity: "シルバー", group: "normal-n" },
                { id: "10002120", name: "キャラバンマンモス", cost: 7, rarity: "シルバー", group: "normal-n" },
                { id: "10102310", name: "熾天使の福音", cost: 3, rarity: "シルバー", group: "normal-n" },
                { id: "10102110", name: "迸る光明アポロン", cost: 3, rarity: "シルバー", group: "normal-n" },
                { id: "10202110", name: "メイドエンジェルチェレッタ", cost: 2, rarity: "シルバー", group: "normal-n" },
                { id: "10103110", name: "楽朗の天宮フィルドア", cost: 2, rarity: "ゴールド", group: "normal-n" },
                { id: "10103310", name: "神の雷霆", cost: 4, rarity: "ゴールド", group: "normal-n" },
                { id: "10203110", name: "絆の天使レイナ", cost: 7, rarity: "ゴールド", group: "normal-n" },
                { id: "10203120", name: "雷火の双神フニカル＆ヤヴンハール", cost: 2, rarity: "ゴールド", group: "normal-n" },
                { id: "10104110", name: "勇壮の堕天使オリヴィエ", cost: 7, rarity: "レジェンド", group: "normal-n" },
                { id: "10104120", name: "最果ての罪サタン", cost: 10, rarity: "レジェンド", group: "normal-n" },
                { id: "10204120", name: "颶風の天業グリームニル", cost: 3, rarity: "レジェンド", group: "normal-n" },
                { id: "10204110", name: "運命の黄昏オーディン", cost: 7, rarity: "レジェンド", group: "normal-n" },
            ];

            const cardData = {
                "エルフ": {
                    classCards: [
                        { id: "10312120", name: "樹海の戦士", cost: 4, rarity: "シルバー", group: "new" },
                        { id: "10311120", name: "妖精剣の担い手", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10311310", name: "野生の猛襲", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10311110", name: "不殺の肯定者", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10313310", name: "駆逐の死矢", cost: 1, rarity: "ゴールド", group: "new" },
                        { id: "10312110", name: "不殺の祈祷者", cost: 6, rarity: "シルバー", group: "new" },
                        { id: "10312210", name: "不殺の里", cost: 3, rarity: "シルバー", group: "new" },
                        { id: "10313110", name: "不殺の団結者", cost: 9, rarity: "ゴールド", group: "new" },
                        { id: "10314120", name: "絶命の顕現エズディア", cost: 8, rarity: "レジェンド", group: "new" },
                        { id: "10314110", name: "不殺の継承者クルル", cost: 4, rarity: "レジェンド", group: "new" },
                        { id: "10011120", name: "ストレイビーストマン", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10011110", name: "フェアリーテイマー", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10011210", name: "繚乱の庭", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10011130", name: "温厚なるトレント", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10111310", name: "妖精の招集", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10111110", name: "舞い踊る妖精", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10111120", name: "コンタクトフェアリー", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10111140", name: "働きバッタ", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10111150", name: "言の葉のエルダーウィードマン", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10111130", name: "深奥のフェアリービースト", cost: 8, rarity: "ブロンズ", group: "normal" },
                        { id: "10211110", name: "ワイルドガール", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10211310", name: "森の行進", cost: 7, rarity: "ブロンズ", group: "normal" },
                        { id: "10211120", name: "木槌のドワーフ", cost: 5, rarity: "ブロンズ", group: "normal" },

                        { id: "10012110", name: "アドベンチャーエルフメイ", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10112120", name: "純粋なるウォーターフェアリー", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10012310", name: "虫の知らせ", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10112130", name: "ベビーカーバンクル", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10112210", name: "燐光の岩", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10112310", name: "薫交の思慕", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10012120", name: "ソニックアーチャーセルウィン", cost: 7, rarity: "シルバー", group: "normal" },
                        { id: "10112110", name: "フロストクリスタリアエリン", cost: 7, rarity: "シルバー", group: "normal" },
                        { id: "10212310", name: "樹上からの急襲", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10212110", name: "アーデントエルフレオネル", cost: 6, rarity: "シルバー", group: "normal" },
                        { id: "10212120", name: "フェアリーフェンサー", cost: 2, rarity: "シルバー", group: "normal" },

                        { id: "10113110", name: "ピュアクリスタリアリリィ", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10113140", name: "殺戮のリノセウス", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10113210", name: "聖樹の杖", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10113120", name: "薫交の天宮バックウッド", cost: 5, rarity: "ゴールド", group: "normal" },
                        { id: "10113130", name: "煌撃の戦士ベイル", cost: 8, rarity: "ゴールド", group: "normal" },
                        { id: "10213310", name: "花園の導き", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10213110", name: "フォレストシバルリーシンシア", cost: 2, rarity: "ゴールド", group: "normal" },

                        { id: "10114130", name: "ビギンズブレイダーアマツ", cost: 3, rarity: "レジェンド", group: "normal" },
                        { id: "10114110", name: "自然の妖精姫アリア", cost: 6, rarity: "レジェンド", group: "normal" },
                        { id: "10114120", name: "豊麗なるローズクイーン", cost: 9, rarity: "レジェンド", group: "normal" },
                        { id: "10214110", name: "翅の女王ティターニア", cost: 4, rarity: "レジェンド", group: "normal" },
                        { id: "10214120", name: "絡み付く密林リマーガ", cost: 7, rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ロイヤル": {
                    classCards: [
                        { id: "10322110", name: "簒奪の祈祷者", cost: 2, rarity: "シルバー", group: "new" },
                        { id: "10321110", name: "簒奪の肯定者", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10321310", name: "シールドバッシュ", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10321120", name: "剣聖の同胞", cost: 6, rarity: "ブロンズ", group: "new" },
                        { id: "10323110", name: "簒奪の団結者", cost: 4, rarity: "ゴールド", group: "new" },
                        { id: "10322120", name: "スナッピースカウト", cost: 5, rarity: "シルバー", group: "new" },
                        { id: "10322210", name: "簒奪のアジト", cost: 1, rarity: "シルバー", group: "new" },
                        { id: "10323310", name: "返還の剣閃", cost: 1, rarity: "ゴールド", group: "new" },
                        { id: "10324120", name: "空絶の顕現オクトリス", cost: 3, rarity: "レジェンド", group: "new" },
                        { id: "10324110", name: "簒奪の継承者シンセライズ", cost: 6, rarity: "レジェンド", group: "new" },

                        { id: "10021110", name: "刹那のクイックブレイダー", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10021310", name: "メイドの作法", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10021120", name: "バトルマーチャント", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10021130", name: "ケンタウロスの騎士", cost: 8, rarity: "ブロンズ", group: "normal" },
                        { id: "10121150", name: "異端の侍", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10121110", name: "愛の騎士イアン", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10121130", name: "救援のルミナスヒーラーリララ", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10121140", name: "ミリタリードッグ", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10121310", name: "剣士の斬撃", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10121120", name: "ピースディーラーエルネスタ", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10221310", name: "商談成立", cost: 0, rarity: "ブロンズ", group: "normal" },
                        { id: "10221120", name: "暗闘のニンジャマスター", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10221110", name: "トリガーメイドセリエ", cost: 2, rarity: "ブロンズ", group: "normal" },

                        { id: "10022110", name: "王家の御者", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10022120", name: "魔煌のトリックスターラスティ", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10022210", name: "正統なる王冠", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10122110", name: "統率のルミナスナイト", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10122140", name: "忍びのムササビ", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10122130", name: "勇猛のルミナスランサー", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10122310", name: "王断の威光", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10122120", name: "卓越のルミナスメイジ", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10222120", name: "オーディナリーナイトラキル", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10222110", name: "豪胆なる副団長ゲルト", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10222310", name: "三将姫の乱撃", cost: 2, rarity: "シルバー", group: "normal" },

                        { id: "10123120", name: "サイレントスナイパーワルツ", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10123130", name: "王断の天宮スタチウム", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10123310", name: "テンタクルバイト", cost: 7, rarity: "ゴールド", group: "normal" },
                        { id: "10123110", name: "レヴィオンアックスジェノ", cost: 8, rarity: "ゴールド", group: "normal" },
                        { id: "10123140", name: "煌刃の勇者アマリア", cost: 8, rarity: "ゴールド", group: "normal" },
                        { id: "10223110", name: "ソードプリンセスロゼ", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10223120", name: "休日の王女プリム", cost: 2, rarity: "ゴールド", group: "normal" },

                        { id: "10124130", name: "常在戦場カゲミツ", cost: 3, rarity: "レジェンド", group: "normal" },
                        { id: "10124110", name: "レヴィオンの迅雷アルベール", cost: 5, rarity: "レジェンド", group: "normal" },
                        { id: "10124120", name: "白銀の騎士団長エミリア", cost: 6, rarity: "レジェンド", group: "normal" },
                        { id: "10224120", name: "レヴィオンの超越者ユリウス", cost: 8, rarity: "レジェンド", group: "normal" },
                        { id: "10224110", name: "静寂のアナテマギルダリア", cost: 6, rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ウィッチ": {
                    classCards: [
                        { id: "10332310", name: "デュアルクリエイト", cost: 4, rarity: "シルバー", group: "new" },
                        { id: "10331310", name: "クリスタルゲイジング", cost: 4, rarity: "ブロンズ", group: "new" },
                        { id: "10331110", name: "真実の肯定者", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10331120", name: "五行の修行者", cost: 4, rarity: "ブロンズ", group: "new" },
                        { id: "10333310", name: "虚偽の術式", cost: 2, rarity: "ゴールド", group: "new" },
                        { id: "10332110", name: "真実の祈祷者", cost: 5, rarity: "シルバー", group: "new" },
                        { id: "10332210", name: "真実の研究施設", cost: 3, rarity: "シルバー", group: "new" },
                        { id: "10333110", name: "真実の団結者", cost: 3, rarity: "ゴールド", group: "new" },
                        { id: "10334120", name: "絶尽の顕現ライオ", cost: 9, rarity: "レジェンド", group: "new" },
                        { id: "10334110", name: "真実の継承者ヴェハリヤー", cost: 2, rarity: "レジェンド", group: "new" },

                        { id: "10031310", name: "知恵の輝き", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10031210", name: "魔女の錬金釜", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10031320", name: "真理の召喚", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10031110", name: "閃光の魔法剣士", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10131320", name: "ストームブラスト", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10131310", name: "虹の奇跡", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10131120", name: "見習い占星術師", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10131130", name: "オウルサモナー", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10131140", name: "夢想のペンギンウィザード", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10131110", name: "ルーンブレイドコンダクター", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10231120", name: "魔導の司書", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10231310", name: "アイスピアース", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10231110", name: "憧憬の魔女メルヴィ", cost: 2, rarity: "ブロンズ", group: "normal" },

                        { id: "10032310", name: "イラプション", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10032110", name: "相貌の魔女レミラミ", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10032120", name: "ブレイズデストロイヤー", cost: 10, rarity: "シルバー", group: "normal" },
                        { id: "10132110", name: "アドラブルティーチャーミラ", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10132310", name: "理光の証明", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10132120", name: "ワンダーウィッチエミル", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10132130", name: "マナリアの学徒ウィリアム", cost: 6, rarity: "シルバー", group: "normal" },
                        { id: "10132320", name: "スノーアウェイク", cost: 8, rarity: "シルバー", group: "normal" },
                        { id: "10232120", name: "調香の魔術師", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10232110", name: "否定の詠唱バーゼント", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10232310", name: "カオスフレイム", cost: 3, rarity: "シルバー", group: "normal" },

                        { id: "10133120", name: "魔法の薬剤師ペネロピー", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10133310", name: "宿題やるですぅ！", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10133130", name: "理光の天宮エーデルワイス", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10133110", name: "黎明の錬金術師ノノ", cost: 5, rarity: "ゴールド", group: "normal" },
                        { id: "10133320", name: "鬼呼びの術", cost: 7, rarity: "ゴールド", group: "normal" },
                        { id: "10233310", name: "パメラの舞踏", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10233110", name: "マナリアの剣士オーウェン", cost: 3, rarity: "ゴールド", group: "normal" },

                        { id: "10134120", name: "マナリアフレンズアン＆グレア", cost: 5, rarity: "レジェンド", group: "normal" },
                        { id: "10134110", name: "五行の果てクオン", cost: 7, rarity: "レジェンド", group: "normal" },
                        { id: "10134310", name: "オーバーディメンション", cost: 18, rarity: "レジェンド", group: "normal" },
                        { id: "10234120", name: "アダマントアルケミストノーマン", cost: 6, rarity: "レジェンド", group: "normal" },
                        { id: "10234110", name: "暴食のアナテマララアンセム", cost: 8, rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ドラゴン": {
                    classCards: [
                        { id: "10342210", name: "侮蔑の国", cost: 2, rarity: "シルバー", group: "new" },
                        { id: "10341120", name: "吹雪のドラゴニュート", cost: 6, rarity: "ブロンズ", group: "new" },
                        { id: "10341110", name: "侮蔑の肯定者", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10341310", name: "サンダーレイジ", cost: 3, rarity: "ブロンズ", group: "new" },
                        { id: "10343110", name: "侮蔑の団結者", cost: 6, rarity: "ゴールド", group: "new" },
                        { id: "10342110", name: "侮蔑の祈祷者", cost: 5, rarity: "シルバー", group: "new" },
                        { id: "10342120", name: "オーシャンライダー", cost: 3, rarity: "シルバー", group: "new" },
                        { id: "10343310", name: "蒼炎の猛威", cost: 1, rarity: "ゴールド", group: "new" },
                        { id: "10344110", name: "侮蔑の継承者アジュラフリート", cost: 9, rarity: "レジェンド", group: "new" },
                        { id: "10344120", name: "烈絶の顕現ガルミーユ", cost: 5, rarity: "レジェンド", group: "new" },

                        { id: "10041310", name: "ドラゴニュートクラッシュ", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10041110", name: "烈火のファイアリザード", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10041120", name: "戦斧の竜殺し", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10041130", name: "シャークソルジャー", cost: 8, rarity: "ブロンズ", group: "normal" },
                        { id: "10141140", name: "竜育の少女", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10141130", name: "駆け出しのドラゴンスレイヤー", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10141150", name: "白鱗の御使い", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10141120", name: "海溝の大剣竜", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10141310", name: "ディザスターブレス", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10141110", name: "雲海の騎竜兵", cost: 8, rarity: "ブロンズ", group: "normal" },
                        { id: "10241310", name: "オルカの呼び声", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10241120", name: "飛躍のアイボリードラゴン", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10241110", name: "庇護の知竜", cost: 10, rarity: "ブロンズ", group: "normal" },

                        { id: "10042310", name: "竜の啓示", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10042110", name: "猛撃のドラゴンウォーリアー", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10042120", name: "咆哮の竜使い", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10142310", name: "栄弦の奏楽", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10142120", name: "風を駆る者エイファ", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10142130", name: "風を読む者ゼル", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10142140", name: "艶麗なる竜人マリオン", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10142110", name: "煌牙の義勇キット", cost: 6, rarity: "シルバー", group: "normal" },
                        { id: "10242210", name: "炎竜の剣", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10242110", name: "宿願のドラゴニュートプリンセス", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10242120", name: "歴戦のマーマン", cost: 5, rarity: "シルバー", group: "normal" },

                        { id: "10143210", name: "乙姫の扇", cost: 1, rarity: "ゴールド", group: "normal" },
                        { id: "10143120", name: "栄弦の天宮リュウフウ", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10143130", name: "荒波のドラグーンザハール", cost: 6, rarity: "ゴールド", group: "normal" },
                        { id: "10143140", name: "ナイトフォールドラゴン", cost: 9, rarity: "ゴールド", group: "normal" },
                        { id: "10143110", name: "再臨のジェネシスドラゴン", cost: 10, rarity: "ゴールド", group: "normal" },
                        { id: "10243310", name: "ドラゴニックストライク", cost: 6, rarity: "ゴールド", group: "normal" },
                        { id: "10243110", name: "蒼海の裁きネプチューン", cost: 7, rarity: "ゴールド", group: "normal" },

                        { id: "10144120", name: "覇道の竜翼フォルテ", cost: 6, rarity: "レジェンド", group: "normal" },
                        { id: "10144110", name: "灼熱のアナテマバーンドナイト", cost: 7, rarity: "レジェンド", group: "normal" },
                        { id: "10244120", name: "絢爛なる鳳凰ほーちゃん", cost: 8, rarity: "レジェンド", group: "normal" },
                        { id: "10244110", name: "銀氷の竜少女フィルレイン", cost: 2, rarity: "レジェンド", group: "normal" },
                        { id: "10144130", name: "龍人演義ガリュウ", cost: 8, rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ナイトメア": {
                    classCards: [
                        { id: "10352110", name: "混融の祈祷者", cost: 4, rarity: "シルバー", group: "new" },
                        { id: "10351120", name: "泡沫の鬼姫", cost: 8, rarity: "ブロンズ", group: "new" },
                        { id: "10351310", name: "暴虐の行進", cost: 4, rarity: "ブロンズ", group: "new" },
                        { id: "10351110", name: "混融の肯定者", cost: 3, rarity: "ブロンズ", group: "new" },
                        { id: "10353110", name: "混融の団結者", cost: 5, rarity: "ゴールド", group: "new" },
                        { id: "10352120", name: "フレッシュグレイブキーパー", cost: 2, rarity: "シルバー", group: "new" },
                        { id: "10352210", name: "混融の城", cost: 2, rarity: "シルバー", group: "new" },
                        { id: "10353310", name: "叫喚と憎悪", cost: 3, rarity: "ゴールド", group: "new" },
                        { id: "10354120", name: "絶叫と愛絶の顕現ルルナイ&ヴァーナレク", cost: 7, rarity: "レジェンド", group: "new" },
                        { id: "10354110", name: "混融の継承者シャム=ナクア", cost: 2, rarity: "レジェンド", group: "new" },

                        { id: "10051130", name: "悪辣のレッサーマミー", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10051310", name: "カオティックカース", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10051120", name: "夜の鬼人", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10051110", name: "ウルフマスター", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10151310", name: "死神の一振り", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10151120", name: "無名の悪魔", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10151130", name: "ボーンガール", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10151110", name: "ミッドナイトヴァンパイアエラル", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10151150", name: "禁約の悪魔", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10151140", name: "ジャグリングゴースト", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10251310", name: "カースパーティー", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10251110", name: "シルバーバレットレイヴン", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10251120", name: "怨恨の栽培者", cost: 1, rarity: "ブロンズ", group: "normal" },

                        { id: "10052110", name: "魅惑のサキュバスリリム", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10052310", name: "魂の捕食", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10052120", name: "ラバーズネクロマンサー", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10152120", name: "ナイトメアヴェリィ", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10152110", name: "辣腕の死神ミーノ", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10152210", name: "瞑地の霊園", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10152130", name: "怪奇の探索者ユナ", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10152140", name: "串刺し公ヴラド", cost: 8, rarity: "シルバー", group: "normal" },
                        { id: "10252310", name: "蝙蝠の使役", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10252110", name: "ブラストウィングピユラ", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10252120", name: "コープスソルジャー", cost: 6, rarity: "シルバー", group: "normal" },

                        { id: "10153310", name: "蛇神の怒り", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10153120", name: "燃え盛る魔剣オルトロス", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10153140", name: "闇の賞金稼ぎバルト", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10153110", name: "青薔薇の令嬢セレス", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10153130", name: "瞑地の天宮ムカン", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10253120", name: "ノクターンジェネラルエクセラ", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10253110", name: "クルーエルウォーラウラ", cost: 3, rarity: "ゴールド", group: "normal" },

                        { id: "10154130", name: "エンドレスハンターアラガヴィ", cost: 5, rarity: "レジェンド", group: "normal" },
                        { id: "10154120", name: "猛毒姫メドゥーサ", cost: 7, rarity: "レジェンド", group: "normal" },
                        { id: "10154110", name: "奔放なる獄炎ケルベロス", cost: 8, rarity: "レジェンド", group: "normal" },
                        { id: "10254120", name: "流れ堕つ冥河カローン", cost: 5, rarity: "レジェンド", group: "normal" },
                        { id: "10254110", name: "双輪夜行ギンセツ&ユヅキ", cost: 09, rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ビショップ": {
                    classCards: [
                        { id: "10362210", name: "安息の神殿", cost: 3, rarity: "シルバー", group: "new" },
                        { id: "10361110", name: "安息の肯定者", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10361120", name: "聖騎士の団員", cost: 2, rarity: "ブロンズ", group: "new" },
                        { id: "10361310", name: "セイントフラッシュ", cost: 4, rarity: "ブロンズ", group: "new" },
                        { id: "10363210", name: "輝く失意", cost: 4, rarity: "ゴールド", group: "new" },
                        { id: "10362220", name: "有翼の獅子像", cost: 3, rarity: "シルバー", group: "new" },
                        { id: "10362110", name: "安息の祈祷者", cost: 3, rarity: "シルバー", group: "new" },
                        { id: "10363110", name: "安息の団結者", cost: 5, rarity: "ゴールド", group: "new" },
                        { id: "10364110", name: "安息の継承者ヒメカ", cost: 6, rarity: "レジェンド", group: "new" },
                        { id: "10364120", name: "絶望の顕現マーウィン", cost: 4, rarity: "レジェンド", group: "new" },

                        { id: "10061120", name: "清純なる白狐", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10061130", name: "ウィングウォーリアー", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10061210", name: "投影の鳥像", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10061110", name: "癒しのシスター", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10161210", name: "穏やかなる教会", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10161140", name: "潜みしマイニュ", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10161110", name: "聖心のプリズムプリースト", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10161120", name: "セイントシールダー", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10161130", name: "標を与えるレディアンスエンジェル", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10161310", name: "フェザーレイン", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10261210", name: "光の香炉", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10261110", name: "粉砕の聖職者", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10261120", name: "マリスオラクルダムス", cost: 2, rarity: "ブロンズ", group: "normal" },

                        { id: "10062210", name: "有翼の石像", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10062110", name: "鉄拳の神父", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10062120", name: "セイクリッドグリフォン", cost: 8, rarity: "シルバー", group: "normal" },
                        { id: "10162210", name: "禁密の聖地", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10162110", name: "煌槍のアルミラージサリッサ", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10162220", name: "セイクリッドインジェクション", cost: 3, rarity: "シルバー", group: "normal" },
                        { id: "10162120", name: "煌翼のフェザーフォルクリノ", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10162130", name: "大地の守護神ミーヴェ", cost: 7, rarity: "シルバー", group: "normal" },
                        { id: "10262120", name: "潔癖の審判者", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10262310", name: "ディバインガード", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10262110", name: "バラージエクソシストコレット", cost: 3, rarity: "シルバー", group: "normal" },

                        { id: "10163210", name: "獣姫の誓約", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10163120", name: "禁密の天宮ロナヴェロ", cost: 4, rarity: "ゴールド", group: "normal" },
                        { id: "10163110", name: "終焉のスカルフェイン", cost: 6, rarity: "ゴールド", group: "normal" },
                        { id: "10163220", name: "邪教の器", cost: 6, rarity: "ゴールド", group: "normal" },
                        { id: "10163130", name: "大いなる熾天使ラピス", cost: 8, rarity: "ゴールド", group: "normal" },
                        { id: "10263310", name: "狂おしき恩寵", cost: 2, rarity: "ゴールド", group: "normal" },
                        { id: "10263110", name: "速断の刃アニエス", cost: 5, rarity: "ゴールド", group: "normal" },

                        { id: "10164130", name: "水の守護神サレファ", cost: 5, rarity: "レジェンド", group: "normal" },
                        { id: "10164110", name: "裁決のアナテマロデオ", cost: 7, rarity: "レジェンド", group: "normal" },
                        { id: "10164120", name: "純白の聖女ジャンヌ", cost: 8, rarity: "レジェンド", group: "normal" },
                        { id: "10264110", name: "天の守護神アイテール", cost: 7, rarity: "レジェンド", group: "normal" },
                        { id: "10264120", name: "嗚咽の聖騎士ウィルバート", cost: 6, rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ネメシス": {
                    classCards: [
                        { id: "10372120", name: "フィールドエンジニア", cost: 5, rarity: "シルバー", group: "new" },
                        { id: "10371120", name: "音速の飛行兵", cost: 7, rarity: "ブロンズ", group: "new" },
                        { id: "10371110", name: "破壊の肯定者", cost: 4, rarity: "ブロンズ", group: "new" },
                        { id: "10371310", name: "ストリングアサルト", cost: 4, rarity: "ブロンズ", group: "new" },
                        { id: "10373310", name: "殲滅の歌声", cost: 2, rarity: "ゴールド", group: "new" },
                        { id: "10372210", name: "破壊の荒野", cost: 2, rarity: "シルバー", group: "new" },
                        { id: "10372110", name: "破壊の祈祷者", cost: 2, rarity: "シルバー", group: "new" },
                        { id: "10373110", name: "破壊の団結者", cost: 6, rarity: "ゴールド", group: "new" },
                        { id: "10374110", name: "破壊の継承者アクシア", cost: 3, rarity: "レジェンド", group: "new" },
                        { id: "10374120", name: "奏絶の顕現リーシェナ", cost: 4, rarity: "レジェンド", group: "new" },

                        { id: "10171320", name: "アーティファクトチャージ", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10171110", name: "ビビッドインベンターイリス", cost: 1, rarity: "ブロンズ", group: "normal" },
                        { id: "10171130", name: "アンストッパブルガンナー", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10071120", name: "マリオネットランサー", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10171140", name: "オートマタアサシン", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10171310", name: "人形の身代わり", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10071110", name: "砲撃の猫獣人", cost: 3, rarity: "ブロンズ", group: "normal" },
                        { id: "10071310", name: "異次元からの銃撃", cost: 4, rarity: "ブロンズ", group: "normal" },
                        { id: "10171120", name: "メタルマーセナリーディルク", cost: 5, rarity: "ブロンズ", group: "normal" },
                        { id: "10071130", name: "獣性の鉄人", cost: 6, rarity: "ブロンズ", group: "normal" },
                        { id: "10271210", name: "アーティファクトカタパルト", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10271120", name: "パペットキャット", cost: 2, rarity: "ブロンズ", group: "normal" },
                        { id: "10271110", name: "エンジンブレイダー", cost: 6, rarity: "ブロンズ", group: "normal" },

                        { id: "10172120", name: "愛執のドールユーザー", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10172310", name: "命の奔流", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10072110", name: "エレクトロウィッパー", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10072210", name: "ドールズシアター", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10172110", name: "ストラグルリーダールキナ", cost: 4, rarity: "シルバー", group: "normal" },
                        { id: "10172320", name: "改境の再動", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10072120", name: "魔鋼の騎兵", cost: 5, rarity: "シルバー", group: "normal" },
                        { id: "10172130", name: "殺意の糸ノア", cost: 6, rarity: "シルバー", group: "normal" },
                        { id: "10272310", name: "イカロスの飛翔", cost: 1, rarity: "シルバー", group: "normal" },
                        { id: "10272110", name: "ハートスローターフィア", cost: 2, rarity: "シルバー", group: "normal" },
                        { id: "10272120", name: "ディスペアロードアキム", cost: 5, rarity: "シルバー", group: "normal" },

                        { id: "10173110", name: "レゾリューションミリアム", cost: 3, rarity: "ゴールド", group: "normal" },
                        { id: "10173210", name: "遺産の砲撃", cost: 5, rarity: "ゴールド", group: "normal" },
                        { id: "10173140", name: "改境の天宮アルエット", cost: 5, rarity: "ゴールド", group: "normal" },
                        { id: "10173120", name: "箱庭の断罪者シルヴィア", cost: 6, rarity: "ゴールド", group: "normal" },
                        { id: "10173130", name: "狂気の創造者リーアム", cost: 10, rarity: "ゴールド", group: "normal" },
                        { id: "10273310", name: "心有る共闘", cost: 6, rarity: "ゴールド", group: "normal" },
                        { id: "10273110", name: "暗獄の残光ジャスパー", cost: 2, rarity: "ゴールド", group: "normal" },

                        { id: "10174110", name: "新たなる少女エース", cost: 3, rarity: "レジェンド", group: "normal" },
                        { id: "10174130", name: "ブーストエクステンドララミア", cost: 8, rarity: "レジェンド", group: "normal" },
                        { id: "10174120", name: "プロシードハートオーキス", cost: 8, rarity: "レジェンド", group: "normal" },
                        { id: "10274120", name: "マインドアーツカルラ", cost: 6, rarity: "レジェンド", group: "normal" },
                        { id: "10274110", name: "シンフォニアハートツヴァイ", cost: 5, rarity: "レジェンド", group: "normal" },
                    ]
                },
            };

            // 全クラスのカードにニュートラルカードを追加
            for (const className in cardData) {
                cardData[className].cards = [...cardData[className].classCards, ...neutralCards];
            }

            const pickProbability = [
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "ゴールド", groups: { "normal": 0.62, "new": 0.21, "normal-n": 0.11, "new-n": 0.06, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "ゴールド/レジェンド", groups: { "normal": 0.59, "new": 0.24, "normal-n": 0.11, "new-n": 0.06, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ゴールド/レジェンド", groups: { "normal": 0.59, "new": 0.24, "normal-n": 0.11, "new-n": 0.06, } },
            ];

            const state = {
                currentClass: null,
                deck: {},
                pickCount: 0,
                rerollCount: 2,
                cardsInDeckCount: 0
            };

            const elements = {
                classSelection: document.getElementById('class-selection'),
                pickPhase: document.getElementById('pick-phase'),
                classButtons: document.getElementById('class-buttons'),
                cardChoicesContainer: document.getElementById('card-choices-container'),
                rerollButton: document.getElementById('reroll-button'),
                rerollCount: document.getElementById('reroll-count'),
                pickCountDisplay: document.getElementById('pick-count'),
                currentDeck: document.getElementById('current-deck'),
                log: document.getElementById('log'),
                statusMessage: document.getElementById('status-message'),
                deckCardCount: document.getElementById('deck-card-count')
            };

            /**
             * カードIDをWorlds Beyond仕様のハッシュ値に変換します。
             * @param {number} id - 変換するカードID
             * @returns {string} - 4文字のハッシュ値
             */
            function convertIdToHash(id) {
                const ALPHABET = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_';
                if (id === 0) {
                    return ALPHABET[0].repeat(4);
                }

                let num = id;
                let hash = '';

                while (num > 0) {
                    const remainder = num % 64;
                    hash = ALPHABET[remainder] + hash;
                    num = Math.floor(num / 64);
                }

                // 4文字になるように先頭を0で埋める
                while (hash.length < 4) {
                    hash = ALPHABET[0] + hash;
                }

                return hash;
            }

            /**
             * デッキリストをQRコード生成用に正しい順序に並び替えます。
             * @param {object} deck - { cardName: { cardObject, count: n } } 形式のデッキオブジェクト
             * @returns {Array<string>} - 並び替え済みのカードIDの配列
             */
            function sortDeckForQrCode(deck) {
                const sortedCards = [];

                // デッキオブジェクトをカードオブジェクトの配列に変換
                for (const cardName in deck) {
                    const cardInfo = deck[cardName];
                    for (let i = 0; i < cardInfo.count; i++) {
                        sortedCards.push(cardInfo);
                    }
                }

                // カードをルールに従ってソート
                sortedCards.sort((a, b) => {
                    // 1. コストで比較
                    if (a.cost !== b.cost) {
                        return a.cost - b.cost;
                    }

                    // IDから各種情報をパース
                    const parseId = (id) => {
                        if (!id || id.length !== 8) return { classId: 9, typeId: 9, packId: 999, rarityId: 9, number: 99 };
                        return {
                            packId: parseInt(id.substring(0, 3)),
                            classId: parseInt(id.substring(3, 4)),
                            rarityId: parseInt(id.substring(4, 5)),
                            typeId: parseInt(id.substring(5, 6)),
                            number: parseInt(id.substring(6, 8))
                        };
                    };

                    const idA = parseId(a.id);
                    const idB = parseId(b.id);

                    // 2. クラスで比較 (ニュートラル:0, エルフ:1, ...)
                    if (idA.classId !== idB.classId) {
                        return idA.classId - idB.classId;
                    }

                    // 3. カードの種類で比較 (フォロワー:1, アミュレット:2, スペル:3)
                    if (idA.typeId !== idB.typeId) {
                        return idA.typeId - idB.typeId;
                    }

                    // 4. カードパックで比較
                    if (idA.packId !== idB.packId) {
                        return idA.packId - idB.packId;
                    }

                    // 5. レアリティで比較
                    if (idA.rarityId !== idB.rarityId) {
                        return idA.rarityId - idB.rarityId;
                    }

                    // 6. カード番号で比較
                    return idA.number - idB.number;
                });

                // ソートされたカードのID配列を返す
                return sortedCards.map(card => card.id);
            }

            let manaCurveChart = null; // チャートのインスタンスを保持する変数
            
            function renderManaCurveChart() {
                const manaCounts = {};
                for (let i = 0; i <= 10; i++) {
                    manaCounts[i] = 0;
                }
            
                for (const cardName in state.deck) {
                    const card = state.deck[cardName];
                    if (card.cost >= 10) {
                        manaCounts[10] += card.count; // 10コスト以上は10にまとめる
                    } else {
                        manaCounts[card.cost] = (manaCounts[card.cost] || 0) + card.count;
                    }
                }
            
                const ctx = document.getElementById('mana-curve-chart').getContext('2d');
                const labels = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10+"];
                const data = Object.values(manaCounts);
            
                if (manaCurveChart) {
                    manaCurveChart.data.datasets[0].data = data;
                    manaCurveChart.update();
                } else {
                    manaCurveChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: '枚数',
                                data: data,
                                backgroundColor: '#3b82f6',
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1 // Y軸の目盛りを1ずつにする
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false // グラフのラベルを非表示に
                                }
                            }
                        }
                    });
                }
            }

            function initializeSimulator() {
                renderClassSelection();
                elements.rerollCount.textContent = state.rerollCount;
                updateDeckCardCountDisplay();
            }

            function getGuaranteedCards(className) {
                const classCards = cardData[className].classCards;
                const legendCards = classCards.filter(c => c.rarity === "レジェンド");
                const goldCards = classCards.filter(c => c.rarity === "ゴールド");
                const allHighRarityCards = [...legendCards, ...goldCards];

                const card1 = legendCards[Math.floor(Math.random() * legendCards.length)];

                let card2 = null;
                let attempts = 0;
                do {
                    card2 = allHighRarityCards[Math.floor(Math.random() * allHighRarityCards.length)];
                    attempts++;
                } while (card1 && card2 && card1.name === card2.name && attempts < 10);

                return [card1, card2];
            }

            function renderClassSelection() {
                elements.classButtons.innerHTML = '';
                for (const className in cardData) {
                    const guaranteedCards = getGuaranteedCards(className);
                    const button = document.createElement('div');
                    button.classList.add('class-select-button');
                    button.innerHTML = `
                        <h3>${className}</h3>
                        <p class="card-name">${guaranteedCards[0].name}</p>
                        <p class="card-name">${guaranteedCards[1].name}</p>
                    `;
                    button.onclick = () => selectClass(className, guaranteedCards);
                    elements.classButtons.appendChild(button);
                }
            }

            function selectClass(className, guaranteedCards) {
                state.currentClass = className;
                state.cardsInDeckCount = 0;
                state.deck = {};

                // 確定カードをデッキに追加
                addCardToDeck(guaranteedCards[0]);
                addCardToDeck(guaranteedCards[1]);

                elements.classSelection.style.display = 'none';
                elements.pickPhase.style.display = 'block';

                state.pickCount = 0;
                elements.pickCountDisplay.textContent = `${state.pickCount}/19`;

                pickNext();
            }

            function pickNext() {
                if (state.pickCount >= 19) {
                    endSimulation();
                    return;
                }

                state.pickCount++;
                elements.pickCountDisplay.textContent = `${state.pickCount}/19`;

                const choices = getChoicesForPick(state.pickCount - 1);
                renderChoices(choices);
            }

            function getChoicesForPick(pickIndex) {
                const pickInfo = pickProbability[pickIndex];
                const choices = [];
                let allCardsForPick = [];

                // 抽選対象の4枚をまとめて選ぶ
                for (let i = 0; i < 4; i++) {
                    const group = weightedRandom(pickInfo.groups);
                    const card = getRandomCard(pickInfo.rarity, group, allCardsForPick);
                    if (card) {
                        allCardsForPick.push(card);
                    }
                }

                // 4枚を2枚ずつのペアに分割
                choices.push([allCardsForPick[0], allCardsForPick[1]]);
                choices.push([allCardsForPick[2], allCardsForPick[3]]);

                return choices;
            }

            function weightedRandom(weights) {
                const totalWeight = Object.values(weights).reduce((sum, w) => sum + w, 0);
                let randomNum = Math.random() * totalWeight;

                for (const group in weights) {
                    randomNum -= weights[group];
                    if (randomNum <= 0) {
                        return group;
                    }
                }
                return Object.keys(weights)[0];
            }

            function getRandomCard(rarity, group, excludeCards = []) {
                const cardPool = cardData[state.currentClass].cards.filter(c => {
                    let rarityMatch = false;
                    if (rarity === "ゴールド/レジェンド") {
                        rarityMatch = c.rarity === "ゴールド" || c.rarity === "レジェンド";
                    } else {
                        rarityMatch = c.rarity === rarity;
                    }
                    const groupMatch = c.group === group;
                    const exclusionMatch = !excludeCards.some(ec => ec.name === c.name);

                    const isClassCard = cardData[state.currentClass].classCards.some(cc => cc.name === c.name);
                    const isNeutralCard = neutralCards.some(nc => nc.name === c.name);

                    return rarityMatch && groupMatch && exclusionMatch && (isClassCard || isNeutralCard);
                });
                if (cardPool.length === 0) {
                    return null;
                }
                return cardPool[Math.floor(Math.random() * cardPool.length)];
            }

            function renderChoices(choices) {
                elements.cardChoicesContainer.innerHTML = '';
                choices.forEach(pair => {
                    const cardGroupDiv = document.createElement('div');
                    cardGroupDiv.classList.add('card-group');
                    cardGroupDiv.onclick = () => selectCards(pair);

                    pair.forEach(card => {
                        const cardDiv = document.createElement('div');
                        cardDiv.classList.add('card-pair');
                        if (card) {
                            cardDiv.innerHTML = `<p class="card-name">${card.name}</p>`;
                        } else {
                            cardDiv.innerHTML = `<p class="card-name">カードなし</p>`;
                        }
                        cardGroupDiv.appendChild(cardDiv);
                    });
                    elements.cardChoicesContainer.appendChild(cardGroupDiv);
                });
            }

            function selectCards(cards) {
                cards.forEach(card => {
                    if (card) {
                        addCardToDeck(card);
                    }
                });
                pickNext();
            }

            function addCardToDeck(card) {
                if (state.deck[card.name]) {
                    state.deck[card.name].count++;
                } else {
                    state.deck[card.name] = { ...card, count: 1 };
                }
                state.cardsInDeckCount++;
                addLog(`>> ${card.name} を選択しました。`);
                updateDeckDisplay();
            }

            elements.rerollButton.onclick = () => {
                if (state.rerollCount > 0) {
                    state.rerollCount--;
                    elements.rerollCount.textContent = state.rerollCount;
                    addLog(`>> 再抽選を実行しました。残り${state.rerollCount}回。`);

                    const rerollChoices = [];
                    const allCards = cardData[state.currentClass].cards;
                    for (let i = 0; i < 2; i++) {
                        const card1 = allCards[Math.floor(Math.random() * allCards.length)];
                        let card2 = null;
                        let attempts = 0;
                        do {
                            card2 = allCards[Math.floor(Math.random() * allCards.length)];
                            attempts++;
                        } while (card1 && card2 && card1.name === card2.name && attempts < 10);
                        rerollChoices.push([card1, card2]);
                    }
                    renderChoices(rerollChoices);

                } else {
                    addLog(`>> 再抽選回数がありません。`);
                }
            };

            function updateDeckDisplay() {
                elements.currentDeck.innerHTML = '';
                
                // デッキに入っているカードの配列を取得
                const deckAsArray = Object.values(state.deck);

                // sortDeckForQrCode と同じロジックでソート
                deckAsArray.sort((a, b) => {
                    // 1. コストで比較
                    if (a.cost !== b.cost) {
                        return a.cost - b.cost;
                    }

                    // IDから各種情報をパースする内部関数
                    const parseId = (id) => {
                        if (!id || id.length !== 8) return { classId: 9, typeId: 9, packId: 999, rarityId: 9, number: 99 };
                        return {
                            packId: parseInt(id.substring(0, 3)),
                            classId: parseInt(id.substring(3, 4)),
                            rarityId: parseInt(id.substring(4, 5)),
                            typeId: parseInt(id.substring(5, 6)),
                            number: parseInt(id.substring(6, 8))
                        };
                    };
                    
                    const idA = parseId(a.id);
                    const idB = parseId(b.id);

                    // 2. クラスで比較
                    if (idA.classId !== idB.classId) {
                        return idA.classId - idB.classId;
                    }

                    // 3. カードの種類で比較
                    if (idA.typeId !== idB.typeId) {
                        return idA.typeId - idB.typeId;
                    }
                    
                    // 4. カードパックで比較
                    if (idA.packId !== idB.packId) {
                        return idA.packId - idB.packId;
                    }

                    // 5. レアリティで比較
                    if (idA.rarityId !== idB.rarityId) {
                        return idA.rarityId - idB.rarityId;
                    }
                    
                    // 6. カード番号で比較
                    return idA.number - idB.number;
                });

                // ソートされた配列を元にリストを画面に表示
                deckAsArray.forEach(card => {
                    const li = document.createElement('li');
                    li.textContent = `${card.name} x${card.count}`;
                    elements.currentDeck.appendChild(li);
                });

                updateDeckCardCountDisplay();
                // updateDeckDisplay の一番最後に追加
                renderManaCurveChart();
            }

            function updateDeckCardCountDisplay() {
                elements.deckCardCount.textContent = state.cardsInDeckCount;
            }

            function endSimulation() {
                elements.pickPhase.style.display = 'none';
                elements.statusMessage.textContent = "デッキが完成しました！";
                addLog(">> デッキ完成！");
            }

            function addLog(message) {
                const p = document.createElement('p');
                p.textContent = message;
                elements.log.prepend(p);
            }

            const qrCodeContainer = document.getElementById('qrcode-container');
            const generateQrButton = document.getElementById('generate-qr-button');
            const qrCodeDisplay = document.getElementById('qrcode-display');
            let qrcode = null; // QRコードオブジェクトを保持する変数

            generateQrButton.onclick = () => {
                if (Object.keys(state.deck).length === 0) {
                    addLog(">> デッキが空のためQRコードを生成できません。");
                    return;
                }
                
                // 1. デッキのカードIDをルールに従ってソート
                const sortedIds = sortDeckForQrCode(state.deck);
                
                // 2. ソートされた各IDをハッシュに変換
                const hashes = sortedIds.map(id => convertIdToHash(parseInt(id, 10)));
                
                // 3. ハッシュを "." で連結
                const hashString = hashes.join('.');

                // ★★★ 修正箇所 ★★★
                // クラス名をクラス番号に変換するマップ
                const classMap = {
                    "エルフ": 1,
                    "ロイヤル": 2,
                    "ウィッチ": 3,
                    "ドラゴン": 4,
                    "ナイトメア": 5,
                    "ビショップ": 6,
                    "ネメシス": 7
                };
                const classNumber = classMap[state.currentClass] || 0; // 不明な場合は0
                
                // 4. 最終的なURLを構築 (クラス番号を動的に設定)
                const deckUrl = `https://shadowverse-wb.com/ja/deck/detail/?hash=2.${classNumber}.${hashString}`;

                // 5. QRコードを生成・表示
                qrCodeDisplay.style.display = 'block';
                qrCodeDisplay.innerHTML = ''; // 既存のQRコードをクリア
                
                if (qrcode) {
                    qrcode.makeCode(deckUrl); // 既存のオブジェクトで新しいコードを生成
                } else {
                    qrcode = new QRCode(qrCodeDisplay, {
                        text: deckUrl,
                        width: 256,
                        height: 256,
                        correctLevel: QRCode.CorrectLevel.L
                    });
                }
                
                addLog(`>> デッキリンク・QRコードを生成しました。`);
                
                // ★★★ 修正箇所 ★★★
                // ログにURLリンクを表示
                const logP = document.createElement('p');
                const logA = document.createElement('a');
                logA.href = deckUrl;
                logA.textContent = deckUrl;
                logA.target = "_blank"; // リンクを新しいタブで開く
                logA.rel = "noopener noreferrer"; // セキュリティ対策
                logP.appendChild(logA);
                elements.log.prepend(logP); // elements.log は addLog 関数内で使われているログ表示領域の要素です
            };

            initializeSimulator();
        };

    </script>
</body>

</html>
