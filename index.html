<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2Pick Simulator</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: #f3f4f6;
            color: #1f2937;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 960px;
            gap: 2rem;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            width: 100%;
            padding: 2rem;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1, h2, h3 {
            color: #111827;
            text-align: center;
        }

        #status-message {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #4b5563;
        }

        #class-selection, #pick-phase {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .class-buttons, .card-choices-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1.5rem;
            margin-top: 1.5rem;
            width: 100%;
        }

        .class-select-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
            width: 45%;
        }

        .class-select-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .card-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            width: 45%;
            padding: 1rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-sizing: border-box;
        }
        
        .card-group:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .card-pair {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .card-name {
            font-weight: 600;
            font-size: 1rem;
            line-height: 1.5;
            text-align: center;
        }

        .card-pair p {
            margin: 0.25rem 0;
            font-size: 0.875rem;
        }

        .button {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.2s;
            margin-top: 1rem;
        }

        .button:hover {
            background-color: #2563eb;
        }
        
        #reroll-button {
            background-color: #ef4444;
        }
        
        #reroll-button:hover {
            background-color: #dc2626;
        }
        
        .deck-list-container {
            width: 100%;
            max-width: 400px;
            padding: 1.5rem;
            background-color: #fff;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .deck-list {
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .deck-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.95rem;
        }
        
        .deck-list li:last-child {
            border-bottom: none;
        }

        #log {
            margin-top: 2rem;
            padding: 1rem;
            background-color: #e5e7eb;
            border-radius: 0.75rem;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
        }

        #log p {
            margin: 0.5rem 0;
            border-bottom: 1px dashed #9ca3af;
            padding-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        #log p:last-child {
            border-bottom: none;
        }

        .completed-message {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: #10b981;
            margin-top: 2rem;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <h1>2Pick シミュレーター</h1>
            <div id="status-message"></div>
            
            <div id="class-selection">
                <h2>クラス選択</h2>
                <div class="class-buttons" id="class-buttons"></div>
            </div>

            <div id="pick-phase" style="display: none;">
                <h2>ピック段階 <span id="pick-count"></span></h2>
                <p>デッキ枚数：<span id="deck-card-count">0</span>枚</p>
                <div class="card-choices-container" id="card-choices-container"></div>
                <button id="reroll-button" class="button">再抽選 (残り <span id="reroll-count"></span>回)</button>
            </div>
            
            <div class="deck-list-container">
                <h3>デッキリスト</h3>
                <ul id="current-deck" class="deck-list"></ul>
            </div>
            
            <div id="log">
                <h3>ログ</h3>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            const neutralCards = [
                { name: "至高の凌駕", rarity: "ブロンズ", group: "new-n" },
                { name: "干絶の使徒", rarity: "ブロンズ", group: "new-n" },
                { name: "嘆きに立ちし者", rarity: "シルバー", group: "new-n" },
                { name: "干絶の顕現ギルネリーゼ", rarity: "レジェンド", group: "new-n" },
                { name: "勇気に満ちし者", rarity: "ゴールド", group: "new-n" },
                { name: "試練の石板", rarity: "ゴールド", group: "new-n" },
                { name: "絶大の顕現マゼルベイン", rarity: "レジェンド", group: "new-n" },

                { name: "探偵のルーペ", rarity: "ブロンズ", group: "normal-n" },
                { name: "不屈のファイター", rarity: "ブロンズ", group: "normal-n" },
                { name: "ベルエンジェルリア", rarity: "ブロンズ", group: "normal-n" },
                { name: "激震のゴリアテ", rarity: "ブロンズ", group: "normal-n" },
                { name: "グリードケルブルビィ", rarity: "ブロンズ", group: "normal-n" },
                { name: "観察の探偵", rarity: "ブロンズ", group: "normal-n" },
                { name: "ゴブリンの襲撃", rarity: "ブロンズ", group: "normal-n" },
                { name: "リバースチェンジ", rarity: "ブロンズ", group: "normal-n" },
                { name: "二刀のゴブリン", rarity: "ブロンズ", group: "normal-n" },
                { name: "煌響の使者アンリエット", rarity: "シルバー", group: "normal-n" },
                { name: "冒険者のギルド", rarity: "シルバー", group: "normal-n" },
                { name: "キャラバンマンモス", rarity: "シルバー", group: "normal-n" },
                { name: "熾天使の福音", rarity: "シルバー", group: "normal-n" },
                { name: "迸る光明アポロン", rarity: "シルバー", group: "normal-n" },
                { name: "メイドエンジェルチェレッタ", rarity: "シルバー", group: "normal-n" },
                { name: "楽朗の天宮フィルドア", rarity: "ゴールド", group: "normal-n" },
                { name: "神の雷霆", rarity: "ゴールド", group: "normal-n" },
                { name: "絆の天使レイナ", rarity: "ゴールド", group: "normal-n" },
                { name: "雷火の双神フニカル＆ヤヴンハール", rarity: "ゴールド", group: "normal-n" },
                { name: "勇壮の堕天使オリヴィエ", rarity: "レジェンド", group: "normal-n" },
                { name: "最果ての罪サタン", rarity: "レジェンド", group: "normal-n" },
                { name: "颶風の天業グリームニル", rarity: "レジェンド", group: "normal-n" },
                { name: "運命の黄昏オーディン", rarity: "レジェンド", group: "normal-n" },
            ];

            const cardData = {
                "エルフ": {
                    classCards: [
                        { name: "樹海の戦士", rarity: "シルバー", group: "new" },
                        { name: "妖精剣の担い手", rarity: "ブロンズ", group: "new" },
                        { name: "野生の猛襲", rarity: "ブロンズ", group: "new" },
                        { name: "不殺の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "駆逐の死矢", rarity: "ゴールド", group: "new" },
                        { name: "不殺の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "不殺の里", rarity: "シルバー", group: "new" },
                        { name: "不殺の団結者", rarity: "ゴールド", group: "new" },
                        { name: "絶命の顕現エズディア", rarity: "レジェンド", group: "new" },
                        { name: "不殺の継承者クルル", rarity: "レジェンド", group: "new" },
                        { name: "ストレイビーストマン", rarity: "ブロンズ", group: "normal" },
                        { name: "フェアリーテイマー", rarity: "ブロンズ", group: "normal" },
                        { name: "繚乱の庭", rarity: "ブロンズ", group: "normal" },
                        { name: "温厚なるトレント", rarity: "ブロンズ", group: "normal" },
                        { name: "妖精の招集", rarity: "ブロンズ", group: "normal" },
                        { name: "舞い踊る妖精", rarity: "ブロンズ", group: "normal" },
                        { name: "コンタクトフェアリー", rarity: "ブロンズ", group: "normal" },
                        { name: "働きバッタ", rarity: "ブロンズ", group: "normal" },
                        { name: "言の葉のエルダーウィードマン", rarity: "ブロンズ", group: "normal" },
                        { name: "深奥のフェアリービースト", rarity: "ブロンズ", group: "normal" },
                        { name: "ワイルドガール", rarity: "ブロンズ", group: "normal" },
                        { name: "森の行進", rarity: "ブロンズ", group: "normal" },
                        { name: "木槌のドワーフ", rarity: "ブロンズ", group: "normal" },

                        { name: "アドベンチャーエルフメイ", rarity: "シルバー", group: "normal" },
                        { name: "純粋なるウォーターフェアリー", rarity: "シルバー", group: "normal" },
                        { name: "虫の知らせ", rarity: "シルバー", group: "normal" },
                        { name: "ベビーカーバンクル", rarity: "シルバー", group: "normal" },
                        { name: "燐光の岩", rarity: "シルバー", group: "normal" },
                        { name: "薫交の思慕", rarity: "シルバー", group: "normal" },
                        { name: "ソニックアーチャーセルウィン", rarity: "シルバー", group: "normal" },
                        { name: "フロストクリスタリアエリン", rarity: "シルバー", group: "normal" },
                        { name: "樹上からの急襲", rarity: "シルバー", group: "normal" },
                        { name: "アーデントエルフレオネル", rarity: "シルバー", group: "normal" },
                        { name: "フェアリーフェンサー", rarity: "シルバー", group: "normal" },

                        { name: "ピュアクリスタリアリリィ", rarity: "ゴールド", group: "normal" },
                        { name: "殺戮のリノセウス", rarity: "ゴールド", group: "normal" },
                        { name: "聖樹の杖", rarity: "ゴールド", group: "normal" },
                        { name: "薫交の天宮バックウッド", rarity: "ゴールド", group: "normal" },
                        { name: "煌撃の戦士ベイル", rarity: "ゴールド", group: "normal" },
                        { name: "花園の導き", rarity: "ゴールド", group: "normal" },
                        { name: "フォレストシバルリーシンシア", rarity: "ゴールド", group: "normal" },

                        { name: "ビギンズブレイダーアマツ", rarity: "レジェンド", group: "normal" },
                        { name: "自然の妖精姫アリア", rarity: "レジェンド", group: "normal" },
                        { name: "豊麗なるローズクイーン", rarity: "レジェンド", group: "normal" },
                        { name: "翅の女王ティターニア", rarity: "レジェンド", group: "normal" },
                        { name: "絡み付く密林リマーガ", rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ロイヤル": {
                    classCards: [
                        { name: "簒奪の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "簒奪の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "シールドバッシュ", rarity: "ブロンズ", group: "new" },
                        { name: "剣聖の同胞", rarity: "ブロンズ", group: "new" },
                        { name: "簒奪の団結者", rarity: "ゴールド", group: "new" },
                        { name: "スナッピースカウト", rarity: "シルバー", group: "new" },
                        { name: "簒奪のアジト", rarity: "シルバー", group: "new" },
                        { name: "返還の剣閃", rarity: "ゴールド", group: "new" },
                        { name: "空絶の顕現オクトリス", rarity: "レジェンド", group: "new" },
                        { name: "簒奪の継承者シンセライズ", rarity: "レジェンド", group: "new" },

                        { name: "刹那のクイックブレイダー", rarity: "ブロンズ", group: "normal" },
                        { name: "メイドの作法", rarity: "ブロンズ", group: "normal" },
                        { name: "バトルマーチャント", rarity: "ブロンズ", group: "normal" },
                        { name: "ケンタウロスの騎士", rarity: "ブロンズ", group: "normal" },
                        { name: "異端の侍", rarity: "ブロンズ", group: "normal" },
                        { name: "愛の騎士イアン", rarity: "ブロンズ", group: "normal" },
                        { name: "救援のルミナスヒーラーリララ", rarity: "ブロンズ", group: "normal" },
                        { name: "ミリタリードッグ", rarity: "ブロンズ", group: "normal" },
                        { name: "剣士の斬撃", rarity: "ブロンズ", group: "normal" },
                        { name: "ピースディーラーエルネスタ", rarity: "ブロンズ", group: "normal" },
                        { name: "商談成立", rarity: "ブロンズ", group: "normal" },
                        { name: "暗闘のニンジャマスター", rarity: "ブロンズ", group: "normal" },
                        { name: "トリガーメイドセリエ", rarity: "ブロンズ", group: "normal" },

                        { name: "王家の御者", rarity: "シルバー", group: "normal" },
                        { name: "魔煌のトリックスターラスティ", rarity: "シルバー", group: "normal" },
                        { name: "正統なる王冠", rarity: "シルバー", group: "normal" },
                        { name: "統率のルミナスナイト", rarity: "シルバー", group: "normal" },
                        { name: "忍びのムササビ", rarity: "シルバー", group: "normal" },
                        { name: "勇猛のルミナスランサー", rarity: "シルバー", group: "normal" },
                        { name: "王断の威光", rarity: "シルバー", group: "normal" },
                        { name: "卓越のルミナスメイジ", rarity: "シルバー", group: "normal" },
                        { name: "オーディナリーナイトラキル", rarity: "シルバー", group: "normal" },
                        { name: "豪胆なる副団長ゲルト", rarity: "シルバー", group: "normal" },
                        { name: "三将姫の乱撃", rarity: "シルバー", group: "normal" },

                        { name: "サイレントスナイパーワルツ", rarity: "ゴールド", group: "normal" },
                        { name: "王断の天宮スタチウム", rarity: "ゴールド", group: "normal" },
                        { name: "テンタクルバイト", rarity: "ゴールド", group: "normal" },
                        { name: "レヴィオンアックスジェノ", rarity: "ゴールド", group: "normal" },
                        { name: "煌刃の勇者アマリア", rarity: "ゴールド", group: "normal" },
                        { name: "ソードプリンセスロゼ", rarity: "ゴールド", group: "normal" },
                        { name: "休日の王女プリム", rarity: "ゴールド", group: "normal" },

                        { name: "常在戦場カゲミツ", rarity: "レジェンド", group: "normal" },
                        { name: "レヴィオンの迅雷アルベール", rarity: "レジェンド", group: "normal" },
                        { name: "白銀の騎士団長エミリア", rarity: "レジェンド", group: "normal" },
                        { name: "レヴィオンの超越者ユリウス", rarity: "レジェンド", group: "normal" },
                        { name: "静寂のアナテマギルダリア", rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ウィッチ": {
                    classCards: [
                        { name: "デュアルクリエイト", rarity: "シルバー", group: "new" },
                        { name: "クリスタルゲイジング", rarity: "ブロンズ", group: "new" },
                        { name: "真実の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "五行の修行者", rarity: "ブロンズ", group: "new" },
                        { name: "虚偽の術式", rarity: "ゴールド", group: "new" },
                        { name: "真実の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "真実の研究施設", rarity: "シルバー", group: "new" },
                        { name: "真実の団結者", rarity: "ゴールド", group: "new" },
                        { name: "絶尽の顕現ライオ", rarity: "レジェンド", group: "new" },
                        { name: "真実の継承者ヴェハリヤー", rarity: "レジェンド", group: "new" },

                        { name: "知恵の輝き", rarity: "ブロンズ", group: "normal" },
                        { name: "魔女の錬金釜", rarity: "ブロンズ", group: "normal" },
                        { name: "真理の召喚", rarity: "ブロンズ", group: "normal" },
                        { name: "閃光の魔法剣士", rarity: "ブロンズ", group: "normal" },
                        { name: "ストームブラスト", rarity: "ブロンズ", group: "normal" },
                        { name: "虹の奇跡", rarity: "ブロンズ", group: "normal" },
                        { name: "見習い占星術師", rarity: "ブロンズ", group: "normal" },
                        { name: "オウルサモナー", rarity: "ブロンズ", group: "normal" },
                        { name: "夢想のペンギンウィザード", rarity: "ブロンズ", group: "normal" },
                        { name: "ルーンブレイドコンダクター", rarity: "ブロンズ", group: "normal" },
                        { name: "魔導の司書", rarity: "ブロンズ", group: "normal" },
                        { name: "アイスピアース", rarity: "ブロンズ", group: "normal" },
                        { name: "憧憬の魔女メルヴィ", rarity: "ブロンズ", group: "normal" },

                        { name: "イラプション", rarity: "シルバー", group: "normal" },
                        { name: "相貌の魔女レミラミ", rarity: "シルバー", group: "normal" },
                        { name: "ブレイズデストロイヤー", rarity: "シルバー", group: "normal" },
                        { name: "アドラブルティーチャーミラ", rarity: "シルバー", group: "normal" },
                        { name: "理光の証明", rarity: "シルバー", group: "normal" },
                        { name: "ワンダーウィッチエミル", rarity: "シルバー", group: "normal" },
                        { name: "マナリアの学徒ウィリアム", rarity: "シルバー", group: "normal" },
                        { name: "スノーアウェイク", rarity: "シルバー", group: "normal" },
                        { name: "調香の魔術師", rarity: "シルバー", group: "normal" },
                        { name: "否定の詠唱バーゼント", rarity: "シルバー", group: "normal" },
                        { name: "カオスフレイム", rarity: "シルバー", group: "normal" },

                        { name: "魔法の薬剤師ペネロピー", rarity: "ゴールド", group: "normal" },
                        { name: "宿題やるですぅ！", rarity: "ゴールド", group: "normal" },
                        { name: "理光の天宮エーデルワイス", rarity: "ゴールド", group: "normal" },
                        { name: "黎明の錬金術師ノノ", rarity: "ゴールド", group: "normal" },
                        { name: "鬼呼びの術", rarity: "ゴールド", group: "normal" },
                        { name: "パメラの舞踏", rarity: "ゴールド", group: "normal" },
                        { name: "マナリアの剣士オーウェン", rarity: "ゴールド", group: "normal" },

                        { name: "マナリアフレンズアン＆グレア", rarity: "レジェンド", group: "normal" },
                        { name: "五行の果てクオン", rarity: "レジェンド", group: "normal" },
                        { name: "オーバーディメンション", rarity: "レジェンド", group: "normal" },
                        { name: "アダマントアルケミストノーマン", rarity: "レジェンド", group: "normal" },
                        { name: "暴食のアナテマララアンセム", rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ドラゴン": {
                    classCards: [
                        { name: "侮蔑の国", rarity: "シルバー", group: "new" },
                        { name: "吹雪のドラゴニュート", rarity: "ブロンズ", group: "new" },
                        { name: "侮蔑の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "サンダーレイジ", rarity: "ブロンズ", group: "new" },
                        { name: "侮蔑の団結者", rarity: "ゴールド", group: "new" },
                        { name: "侮蔑の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "オーシャンライダー", rarity: "シルバー", group: "new" },
                        { name: "蒼炎の猛威", rarity: "ゴールド", group: "new" },
                        { name: "侮蔑の継承者アジュラフリート", rarity: "レジェンド", group: "new" },
                        { name: "烈絶の顕現ガルミーユ", rarity: "レジェンド", group: "new" },

                        { name: "ドラゴニュートクラッシュ", rarity: "ブロンズ", group: "normal" },
                        { name: "烈火のファイアリザード", rarity: "ブロンズ", group: "normal" },
                        { name: "戦斧の竜殺し", rarity: "ブロンズ", group: "normal" },
                        { name: "シャークソルジャー", rarity: "ブロンズ", group: "normal" },
                        { name: "竜育の少女", rarity: "ブロンズ", group: "normal" },
                        { name: "駆け出しのドラゴンスレイヤー", rarity: "ブロンズ", group: "normal" },
                        { name: "白鱗の御使い", rarity: "ブロンズ", group: "normal" },
                        { name: "海溝の大剣竜", rarity: "ブロンズ", group: "normal" },
                        { name: "ディザスターブレス", rarity: "ブロンズ", group: "normal" },
                        { name: "雲海の騎竜兵", rarity: "ブロンズ", group: "normal" },
                        { name: "オルカの呼び声", rarity: "ブロンズ", group: "normal" },
                        { name: "飛躍のアイボリードラゴン", rarity: "ブロンズ", group: "normal" },
                        { name: "庇護の知竜", rarity: "ブロンズ", group: "normal" },

                        { name: "竜の啓示", rarity: "シルバー", group: "normal" },
                        { name: "猛撃のドラゴンウォーリアー", rarity: "シルバー", group: "normal" },
                        { name: "咆哮の竜使い", rarity: "シルバー", group: "normal" },
                        { name: "栄弦の奏楽", rarity: "シルバー", group: "normal" },
                        { name: "風を駆る者エイファ", rarity: "シルバー", group: "normal" },
                        { name: "風を読む者ゼル", rarity: "シルバー", group: "normal" },
                        { name: "艶麗なる竜人マリオン", rarity: "シルバー", group: "normal" },
                        { name: "煌牙の義勇キット", rarity: "シルバー", group: "normal" },
                        { name: "炎竜の剣", rarity: "シルバー", group: "normal" },
                        { name: "宿願のドラゴニュートプリンセス", rarity: "シルバー", group: "normal" },
                        { name: "歴戦のマーマン", rarity: "シルバー", group: "normal" },

                        { name: "乙姫の扇", rarity: "ゴールド", group: "normal" },
                        { name: "栄弦の天宮リュウフウ", rarity: "ゴールド", group: "normal" },
                        { name: "荒波のドラグーンザハール", rarity: "ゴールド", group: "normal" },
                        { name: "ナイトフォールドラゴン", rarity: "ゴールド", group: "normal" },
                        { name: "再臨のジェネシスドラゴン", rarity: "ゴールド", group: "normal" },
                        { name: "ドラゴニックストライク", rarity: "ゴールド", group: "normal" },
                        { name: "蒼海の裁きネプチューン", rarity: "ゴールド", group: "normal" },

                        { name: "覇道の竜翼フォルテ", rarity: "レジェンド", group: "normal" },
                        { name: "灼熱のアナテマバーンドナイト", rarity: "レジェンド", group: "normal" },
                        { name: "絢爛なる鳳凰ほーちゃん", rarity: "レジェンド", group: "normal" },
                        { name: "銀氷の竜少女フィルレイン", rarity: "レジェンド", group: "normal" },
                        { name: "龍人演義ガリュウ", rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ナイトメア": {
                    classCards: [
                        { name: "混融の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "泡沫の鬼姫", rarity: "ブロンズ", group: "new" },
                        { name: "暴虐の行進", rarity: "ブロンズ", group: "new" },
                        { name: "混融の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "混融の団結者", rarity: "ゴールド", group: "new" },
                        { name: "フレッシュグレイブキーパー", rarity: "シルバー", group: "new" },
                        { name: "混融の城", rarity: "シルバー", group: "new" },
                        { name: "叫喚と憎悪", rarity: "ゴールド", group: "new" },
                        { name: "絶叫と愛絶の顕現ルルナイ&ヴァーナレク", rarity: "レジェンド", group: "new" },
                        { name: "混融の継承者シャム=ナクア", rarity: "レジェンド", group: "new" },

                        { name: "悪辣のレッサーマミー", rarity: "ブロンズ", group: "normal" },
                        { name: "カオティックカース", rarity: "ブロンズ", group: "normal" },
                        { name: "夜の鬼人", rarity: "ブロンズ", group: "normal" },
                        { name: "ウルフマスター", rarity: "ブロンズ", group: "normal" },
                        { name: "死神の一振り", rarity: "ブロンズ", group: "normal" },
                        { name: "無名の悪魔", rarity: "ブロンズ", group: "normal" },
                        { name: "ボーンガール", rarity: "ブロンズ", group: "normal" },
                        { name: "ミッドナイトヴァンパイアエラル", rarity: "ブロンズ", group: "normal" },
                        { name: "禁約の悪魔", rarity: "ブロンズ", group: "normal" },
                        { name: "ジャグリングゴースト", rarity: "ブロンズ", group: "normal" },
                        { name: "カースパーティー", rarity: "ブロンズ", group: "normal" },
                        { name: "シルバーバレットレイヴン", rarity: "ブロンズ", group: "normal" },
                        { name: "怨恨の栽培者", rarity: "ブロンズ", group: "normal" },

                        { name: "魅惑のサキュバスリリム", rarity: "シルバー", group: "normal" },
                        { name: "魂の捕食", rarity: "シルバー", group: "normal" },
                        { name: "ラバーズネクロマンサー", rarity: "シルバー", group: "normal" },
                        { name: "ナイトメアヴェリィ", rarity: "シルバー", group: "normal" },
                        { name: "辣腕の死神ミーノ", rarity: "シルバー", group: "normal" },
                        { name: "瞑地の霊園", rarity: "シルバー", group: "normal" },
                        { name: "怪奇の探索者ユナ", rarity: "シルバー", group: "normal" },
                        { name: "串刺し公ヴラド", rarity: "シルバー", group: "normal" },
                        { name: "蝙蝠の使役", rarity: "シルバー", group: "normal" },
                        { name: "ブラストウィングピユラ", rarity: "シルバー", group: "normal" },
                        { name: "コープスソルジャー", rarity: "シルバー", group: "normal" },

                        { name: "蛇神の怒り", rarity: "ゴールド", group: "normal" },
                        { name: "燃え盛る魔剣オルトロス", rarity: "ゴールド", group: "normal" },
                        { name: "闇の賞金稼ぎバルト", rarity: "ゴールド", group: "normal" },
                        { name: "青薔薇の令嬢セレス", rarity: "ゴールド", group: "normal" },
                        { name: "瞑地の天宮ムカン", rarity: "ゴールド", group: "normal" },
                        { name: "ノクターンジェネラルエクセラ", rarity: "ゴールド", group: "normal" },
                        { name: "クルーエルウォーラウラ", rarity: "ゴールド", group: "normal" },

                        { name: "エンドレスハンターアラガヴィ", rarity: "レジェンド", group: "normal" },
                        { name: "猛毒姫メドゥーサ", rarity: "レジェンド", group: "normal" },
                        { name: "奔放なる獄炎ケルベロス", rarity: "レジェンド", group: "normal" },
                        { name: "流れ堕つ冥河カローン", rarity: "レジェンド", group: "normal" },
                        { name: "双輪夜行ギンセツ&ユヅキ", rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ビショップ": {
                    classCards: [
                        { name: "安息の神殿", rarity: "シルバー", group: "new" },
                        { name: "安息の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "聖騎士の団員", rarity: "ブロンズ", group: "new" },
                        { name: "セイントフラッシュ", rarity: "ブロンズ", group: "new" },
                        { name: "輝く失意", rarity: "ゴールド", group: "new" },
                        { name: "有翼の獅子像", rarity: "シルバー", group: "new" },
                        { name: "安息の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "安息の団結者", rarity: "ゴールド", group: "new" },
                        { name: "安息の継承者ヒメカ", rarity: "レジェンド", group: "new" },
                        { name: "絶望の顕現マーウィン", rarity: "レジェンド", group: "new" },

                        { name: "清純なる白狐", rarity: "ブロンズ", group: "normal" },
                        { name: "ウィングウォーリアー", rarity: "ブロンズ", group: "normal" },
                        { name: "投影の鳥像", rarity: "ブロンズ", group: "normal" },
                        { name: "癒しのシスター", rarity: "ブロンズ", group: "normal" },
                        { name: "穏やかなる教会", rarity: "ブロンズ", group: "normal" },
                        { name: "潜みしマイニュ", rarity: "ブロンズ", group: "normal" },
                        { name: "聖心のプリズムプリースト", rarity: "ブロンズ", group: "normal" },
                        { name: "セイントシールダー", rarity: "ブロンズ", group: "normal" },
                        { name: "標を与えるレディアンスエンジェル", rarity: "ブロンズ", group: "normal" },
                        { name: "フェザーレイン", rarity: "ブロンズ", group: "normal" },
                        { name: "光の香炉", rarity: "ブロンズ", group: "normal" },
                        { name: "粉砕の聖職者", rarity: "ブロンズ", group: "normal" },
                        { name: "マリスオラクルダムス", rarity: "ブロンズ", group: "normal" },

                        { name: "有翼の石像", rarity: "シルバー", group: "normal" },
                        { name: "鉄拳の神父", rarity: "シルバー", group: "normal" },
                        { name: "セイクリッドグリフォン", rarity: "シルバー", group: "normal" },
                        { name: "禁密の聖地", rarity: "シルバー", group: "normal" },
                        { name: "煌槍のアルミラージサリッサ", rarity: "シルバー", group: "normal" },
                        { name: "セイクリッドインジェクション", rarity: "シルバー", group: "normal" },
                        { name: "煌翼のフェザーフォルクリノ", rarity: "シルバー", group: "normal" },
                        { name: "大地の守護神ミーヴェ", rarity: "シルバー", group: "normal" },
                        { name: "潔癖の審判者", rarity: "シルバー", group: "normal" },
                        { name: "ディバインガード", rarity: "シルバー", group: "normal" },
                        { name: "バラージエクソシストコレット", rarity: "シルバー", group: "normal" },

                        { name: "獣姫の誓約", rarity: "ゴールド", group: "normal" },
                        { name: "禁密の天宮ロナヴェロ", rarity: "ゴールド", group: "normal" },
                        { name: "終焉のスカルフェイン", rarity: "ゴールド", group: "normal" },
                        { name: "邪教の器", rarity: "ゴールド", group: "normal" },
                        { name: "大いなる熾天使ラピス", rarity: "ゴールド", group: "normal" },
                        { name: "狂おしき恩寵", rarity: "ゴールド", group: "normal" },
                        { name: "速断の刃アニエス", rarity: "ゴールド", group: "normal" },

                        { name: "水の守護神サレファ", rarity: "レジェンド", group: "normal" },
                        { name: "裁決のアナテマロデオ", rarity: "レジェンド", group: "normal" },
                        { name: "純白の聖女ジャンヌ", rarity: "レジェンド", group: "normal" },
                        { name: "天の守護神アイテール", rarity: "レジェンド", group: "normal" },
                        { name: "嗚咽の聖騎士ウィルバート", rarity: "レジェンド", group: "normal" },
                    ]
                },
                "ネメシス": {
                    classCards: [
                        { name: "フィールドエンジニア", rarity: "シルバー", group: "new" },
                        { name: "音速の飛行兵", rarity: "ブロンズ", group: "new" },
                        { name: "破壊の肯定者", rarity: "ブロンズ", group: "new" },
                        { name: "ストリングアサルト", rarity: "ブロンズ", group: "new" },
                        { name: "殲滅の歌声", rarity: "ゴールド", group: "new" },
                        { name: "破壊の荒野", rarity: "シルバー", group: "new" },
                        { name: "破壊の祈祷者", rarity: "シルバー", group: "new" },
                        { name: "破壊の団結者", rarity: "ゴールド", group: "new" },
                        { name: "破壊の継承者アクシア", rarity: "レジェンド", group: "new" },
                        { name: "奏絶の顕現リーシェナ", rarity: "レジェンド", group: "new" },

                        { name: "アーティファクトチャージ", rarity: "ブロンズ", group: "normal" },
                        { name: "ビビッドインベンターイリス", rarity: "ブロンズ", group: "normal" },
                        { name: "アンストッパブルガンナー", rarity: "ブロンズ", group: "normal" },
                        { name: "マリオネットランサー", rarity: "ブロンズ", group: "normal" },
                        { name: "オートマタアサシン", rarity: "ブロンズ", group: "normal" },
                        { name: "人形の身代わり", rarity: "ブロンズ", group: "normal" },
                        { name: "砲撃の猫獣人", rarity: "ブロンズ", group: "normal" },
                        { name: "異次元からの銃撃", rarity: "ブロンズ", group: "normal" },
                        { name: "メタルマーセナリーディルク", rarity: "ブロンズ", group: "normal" },
                        { name: "獣性の鉄人", rarity: "ブロンズ", group: "normal" },
                        { name: "アーティファクトカタパルト", rarity: "ブロンズ", group: "normal" },
                        { name: "パペットキャット", rarity: "ブロンズ", group: "normal" },
                        { name: "エンジンブレイダー", rarity: "ブロンズ", group: "normal" },

                        { name: "愛執のドールユーザー", rarity: "シルバー", group: "normal" },
                        { name: "命の奔流", rarity: "シルバー", group: "normal" },
                        { name: "エレクトロウィッパー", rarity: "シルバー", group: "normal" },
                        { name: "ドールズシアター", rarity: "シルバー", group: "normal" },
                        { name: "ストラグルリーダールキナ", rarity: "シルバー", group: "normal" },
                        { name: "改境の再動", rarity: "シルバー", group: "normal" },
                        { name: "魔鋼の騎兵", rarity: "シルバー", group: "normal" },
                        { name: "殺意の糸ノア", rarity: "シルバー", group: "normal" },
                        { name: "イカロスの飛翔", rarity: "シルバー", group: "normal" },
                        { name: "ハートスローターフィア", rarity: "シルバー", group: "normal" },
                        { name: "ディスペアロードアキム", rarity: "シルバー", group: "normal" },

                        { name: "レゾリューションミリアム", rarity: "ゴールド", group: "normal" },
                        { name: "遺産の砲撃", rarity: "ゴールド", group: "normal" },
                        { name: "改境の天宮アルエット", rarity: "ゴールド", group: "normal" },
                        { name: "箱庭の断罪者シルヴィア", rarity: "ゴールド", group: "normal" },
                        { name: "狂気の創造者リーアム", rarity: "ゴールド", group: "normal" },
                        { name: "心有る共闘", rarity: "ゴールド", group: "normal" },
                        { name: "暗獄の残光ジャスパー", rarity: "ゴールド", group: "normal" },

                        { name: "新たなる少女エース", rarity: "レジェンド", group: "normal" },
                        { name: "ブーストエクステンドララミア", rarity: "レジェンド", group: "normal" },
                        { name: "プロシードハートオーキス", rarity: "レジェンド", group: "normal" },
                        { name: "マインドアーツカルラ", rarity: "レジェンド", group: "normal" },
                        { name: "シンフォニアハートツヴァイ", rarity: "レジェンド", group: "normal" },
                    ]
                },
            };

            // 全クラスのカードにニュートラルカードを追加
            for (const className in cardData) {
                cardData[className].cards = [...cardData[className].classCards, ...neutralCards];
            }

            const pickProbability = [
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "ゴールド", groups: { "normal": 0.62, "new": 0.21, "normal-n": 0.11, "new-n": 0.06, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "ゴールド/レジェンド", groups: { "normal": 0.59, "new": 0.24, "normal-n": 0.11, "new-n": 0.06, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ブロンズ", groups: { "normal": 0.65, "new": 0.18, "normal-n": 0.13, "new-n": 0.04, } },
                { rarity: "シルバー", groups: { "normal": 0.63, "new": 0.2, "normal-n": 0.14, "new-n": 0.03, } },
                { rarity: "ゴールド/レジェンド", groups: { "normal": 0.59, "new": 0.24, "normal-n": 0.11, "new-n": 0.06, } },
            ];

            const state = {
                currentClass: null,
                deck: {},
                pickCount: 0,
                rerollCount: 2,
                cardsInDeckCount: 0
            };

            const elements = {
                classSelection: document.getElementById('class-selection'),
                pickPhase: document.getElementById('pick-phase'),
                classButtons: document.getElementById('class-buttons'),
                cardChoicesContainer: document.getElementById('card-choices-container'),
                rerollButton: document.getElementById('reroll-button'),
                rerollCount: document.getElementById('reroll-count'),
                pickCountDisplay: document.getElementById('pick-count'),
                currentDeck: document.getElementById('current-deck'),
                log: document.getElementById('log'),
                statusMessage: document.getElementById('status-message'),
                deckCardCount: document.getElementById('deck-card-count')
            };

            function initializeSimulator() {
                renderClassSelection();
                elements.rerollCount.textContent = state.rerollCount;
                updateDeckCardCountDisplay();
            }

            function getGuaranteedCards(className) {
                const classCards = cardData[className].classCards;
                const legendCards = classCards.filter(c => c.rarity === "レジェンド");
                const goldCards = classCards.filter(c => c.rarity === "ゴールド");
                const allHighRarityCards = [...legendCards, ...goldCards];

                const card1 = legendCards[Math.floor(Math.random() * legendCards.length)];
                
                let card2 = null;
                let attempts = 0;
                do {
                    card2 = allHighRarityCards[Math.floor(Math.random() * allHighRarityCards.length)];
                    attempts++;
                } while (card1 && card2 && card1.name === card2.name && attempts < 10);
                
                return [card1, card2];
            }

            function renderClassSelection() {
                elements.classButtons.innerHTML = '';
                for (const className in cardData) {
                    const guaranteedCards = getGuaranteedCards(className);
                    const button = document.createElement('div');
                    button.classList.add('class-select-button');
                    button.innerHTML = `
                        <h3>${className}</h3>
                        <p class="card-name">${guaranteedCards[0].name}</p>
                        <p class="card-name">${guaranteedCards[1].name}</p>
                    `;
                    button.onclick = () => selectClass(className, guaranteedCards);
                    elements.classButtons.appendChild(button);
                }
            }

            function selectClass(className, guaranteedCards) {
                state.currentClass = className;
                state.cardsInDeckCount = 0;
                state.deck = {};
                
                // 確定カードをデッキに追加
                addCardToDeck(guaranteedCards[0]);
                addCardToDeck(guaranteedCards[1]);
                
                elements.classSelection.style.display = 'none';
                elements.pickPhase.style.display = 'block';
                
                state.pickCount = 0;
                elements.pickCountDisplay.textContent = `${state.pickCount}/19`;
                
                pickNext();
            }

            function pickNext() {
                if (state.pickCount >= 19) {
                    endSimulation();
                    return;
                }

                state.pickCount++;
                elements.pickCountDisplay.textContent = `${state.pickCount}/19`;

                const choices = getChoicesForPick(state.pickCount - 1);
                renderChoices(choices);
            }

            function getChoicesForPick(pickIndex) {
                const pickInfo = pickProbability[pickIndex];
                const choices = [];
                let allCardsForPick = [];

                // 抽選対象の4枚をまとめて選ぶ
                for (let i = 0; i < 4; i++) {
                    const group = weightedRandom(pickInfo.groups);
                    const card = getRandomCard(pickInfo.rarity, group, allCardsForPick);
                    if (card) {
                        allCardsForPick.push(card);
                    }
                }
                
                // 4枚を2枚ずつのペアに分割
                choices.push([allCardsForPick[0], allCardsForPick[1]]);
                choices.push([allCardsForPick[2], allCardsForPick[3]]);
                
                return choices;
            }

            function weightedRandom(weights) {
                const totalWeight = Object.values(weights).reduce((sum, w) => sum + w, 0);
                let randomNum = Math.random() * totalWeight;

                for (const group in weights) {
                    randomNum -= weights[group];
                    if (randomNum <= 0) {
                        return group;
                    }
                }
                return Object.keys(weights)[0];
            }

            function getRandomCard(rarity, group, excludeCards = []) {
                const cardPool = cardData[state.currentClass].cards.filter(c => {
                    let rarityMatch = false;
                    if (rarity === "ゴールド/レジェンド") {
                        rarityMatch = c.rarity === "ゴールド" || c.rarity === "レジェンド";
                    } else {
                        rarityMatch = c.rarity === rarity;
                    }
                    const groupMatch = c.group === group;
                    const exclusionMatch = !excludeCards.some(ec => ec.name === c.name);
                    
                    const isClassCard = cardData[state.currentClass].classCards.some(cc => cc.name === c.name);
                    const isNeutralCard = neutralCards.some(nc => nc.name === c.name);

                    return rarityMatch && groupMatch && exclusionMatch && (isClassCard || isNeutralCard);
                });
                if (cardPool.length === 0) {
                    return null;
                }
                return cardPool[Math.floor(Math.random() * cardPool.length)];
            }

            function renderChoices(choices) {
                elements.cardChoicesContainer.innerHTML = '';
                choices.forEach(pair => {
                    const cardGroupDiv = document.createElement('div');
                    cardGroupDiv.classList.add('card-group');
                    cardGroupDiv.onclick = () => selectCards(pair);
                    
                    pair.forEach(card => {
                        const cardDiv = document.createElement('div');
                        cardDiv.classList.add('card-pair');
                        if (card) {
                            cardDiv.innerHTML = `<p class="card-name">${card.name}</p>`;
                        } else {
                            cardDiv.innerHTML = `<p class="card-name">カードなし</p>`;
                        }
                        cardGroupDiv.appendChild(cardDiv);
                    });
                    elements.cardChoicesContainer.appendChild(cardGroupDiv);
                });
            }

            function selectCards(cards) {
                cards.forEach(card => {
                    if (card) {
                        addCardToDeck(card);
                    }
                });
                pickNext();
            }
            
            function addCardToDeck(card) {
                if (state.deck[card.name]) {
                    state.deck[card.name].count++;
                } else {
                    state.deck[card.name] = { ...card, count: 1 };
                }
                state.cardsInDeckCount++;
                addLog(`>> ${card.name} を選択しました。`);
                updateDeckDisplay();
            }

            elements.rerollButton.onclick = () => {
                if (state.rerollCount > 0) {
                    state.rerollCount--;
                    elements.rerollCount.textContent = state.rerollCount;
                    addLog(`>> 再抽選を実行しました。残り${state.rerollCount}回。`);
                    
                    const rerollChoices = [];
                    const allCards = cardData[state.currentClass].cards;
                    for (let i = 0; i < 2; i++) {
                        const card1 = allCards[Math.floor(Math.random() * allCards.length)];
                        let card2 = null;
                        let attempts = 0;
                        do {
                            card2 = allCards[Math.floor(Math.random() * allCards.length)];
                            attempts++;
                        } while (card1 && card2 && card1.name === card2.name && attempts < 10);
                        rerollChoices.push([card1, card2]);
                    }
                    renderChoices(rerollChoices);

                } else {
                    addLog(`>> 再抽選回数がありません。`);
                }
            };

            function updateDeckDisplay() {
                elements.currentDeck.innerHTML = '';
                const sortedDeck = Object.values(state.deck).sort((a, b) => a.rarity.localeCompare(b.rarity));
                sortedDeck.forEach(card => {
                    const li = document.createElement('li');
                    li.textContent = `${card.name} x${card.count}`;
                    elements.currentDeck.appendChild(li);
                });
                updateDeckCardCountDisplay();
            }

            function updateDeckCardCountDisplay() {
                elements.deckCardCount.textContent = state.cardsInDeckCount;
            }

            function endSimulation() {
                elements.pickPhase.style.display = 'none';
                elements.statusMessage.textContent = "デッキが完成しました！";
                addLog(">> デッキ完成！");
            }

            function addLog(message) {
                const p = document.createElement('p');
                p.textContent = message;
                elements.log.prepend(p);
            }

            initializeSimulator();
        };
    </script>
</body>
</html>
